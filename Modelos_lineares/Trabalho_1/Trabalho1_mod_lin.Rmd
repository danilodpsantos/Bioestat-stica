---
title: "Trabalho 1 Modelos Lineares"
author: "Danilo de Paula Santos"
date: "10/18/2019"
output:
  html_document:
    df_print: paged
---

As questões a seguir referem-se ao estudo de Gross et al (1999) sobre a relação entre financiamento pelo National Institutes of Health e carga de 29 doenças. Os dados da Tabela 1 desde estudo estão no arquivo 3.ex.Funding.sav. Os nomes das variáveis e definições neste arquivo são:

!["variaveis"](C:/Users/Gabriela/Documents/Bioestatistica_PPGEPI/Modelos_lineares/Trabalho_1/variaveis_gross.PNG)


```{r preparing_R}

# install.packages("haven")
# install.packages("ggplot2")

library("haven")
library("ggplot2")
library("compareGroups")
library("tidyverse")

dados <- read_spss(file = "3.ex.Funding.sav")

```
# DESCRIÇÃO GERAL DO BANCO

```{r agrupando_diseases}
# transformando disease e factor
dados$disease <- factor(dados$disease)


# Gerando grupos de doenças

dados$disease_group <- ifelse(dados$disease ==  "Breast Cancer"     |
                              dados$disease ==  "Cervical cancer"   |
                              dados$disease ==  "Colorectal cancer" |
                              dados$disease ==  "Lung cancer"     |
                              dados$disease ==  "Ovarian cancer"  |
                              dados$disease ==  "Prostate cancer" |
                              dados$disease ==  "Uterine cancer", "Cancer", 
                              ifelse( dados$disease == "Cirrhosis" |
                                      dados$disease == "Chronic obst. pulmonary d" |
                                      dados$disease == "Ischemic heart disease" |
                                      dados$disease == "Stroke"  |
                                      dados$disease ==  "Diabetes mellitus"|
                                      dados$disease ==   "Asthma" | 
                                      dados$disease == "Peptic ulcer"|
                                      dados$disease == "Alcohol abuse","Non-communicable diseases",
                                      ifelse(dados$disease == "Dental and oral disorders","Other non-communicable diseases",
                                      ifelse(dados$disease == "Dementia" |
                                             dados$disease == "Depression"  |
                                             dados$disease == "Epilepsy"   |
                                             dados$disease == "Parkinson's disease" | 
                                             dados$disease ==  "Multiple sclerosis" |
                                             dados$disease == "Schizophrenia" , "Mental and neurological disorders", 
                                             ifelse(dados$disease == "Tuberculosis"|
                                                    dados$disease == "Sexually transmitted dise"|
                                                    dados$disease == "Pneumonia" |
                                                    dados$disease == "Otitis media"|
                                                    dados$disease == "Perinatal conditions", "Communicable and neonatal diseases",
                                                           ifelse(dados$disease == "Injuries", "Injuries", 
                                                                  ifelse(dados$disease == "AIDS", "AIDS", NA)))))))


```

```{r variaveis_grupos}

dados_grupo <- dados%>%
  group_by(disease_group) %>%
  summarise(dollars_group = sum(dollars, na.rm = TRUE),
            incid_group = sum(incid, na.rm = TRUE),
            preval_group = sum(preval, na.rm = TRUE),
            hospdays_group = sum(hospdays, na.rm = TRUE),
            mort_group = sum(mort, na.rm = TRUE),
            yrslost_group = sum(yrslost, na.rm = TRUE),
            disabil_group = sum(disabil, na.rm = TRUE))

dados <- merge(dados, dados_grupo)

```

```{r descritiva_ex_1 }

compare_doencas <- compareGroups(disease_group ~ dollars_group + incid_group + preval_group + hospdays_group + mort_group + yrslost_group + disabil_group,
                                 data = dados,
                                 max.ylev = 29)

table_descr <- createTable(compare_doencas, show.p.overall = FALSE, show.ratio = TRUE, show.n = FALSE, type = 3)


table_descr
```

1. 

__a) Explore a relação entre dollars e as outras variáveis independentes (exceto disease e id).__ 

```{r scat_function}

#Função que fixa o banco como dados e o y como dólares para criar um scatterplot


dollar_plot <- function(data = dados, x_var = var, y_var = "dollars"){
  
  

  ggplot(data = data,
         aes(x = x_var,
             y = y_var)) +
    geom_point()
  
  
}


```


```{r scat_dol_incid}

ggplot(data = dados,
         aes(x = incid,
             y = dollars)) +
    geom_point()


```




```{r scat_dol_preval}

ggplot(data = dados,
         aes(x = preval,
             y = dollars)) +
    geom_point()


```


```{r scat_dol_hospdays}

ggplot(data = dados,
         aes(x = hospdays,
             y = dollars)) +
    geom_point()



```



```{r scat_dol_mort}

ggplot(data = dados,
         aes(x = mort,
             y = dollars)) +
    geom_point()


```

```{r scat_dol_yrslost}

ggplot(data = dados,
         aes(x = yrslost,
             y = dollars)) +
    geom_point()


```

```{r scat_dol_disabil}

ggplot(data = dados,
         aes(x = disabil,
             y = dollars)) +
    geom_point()


```

__b) Construa manualmente um modelo que você julga que melhor explica o desfecho.__ 





__c) Faça o gráfico dos valores preditos versus os resíduos studentizados. Interprete os resultados.__







2. Transforme todas as variáveis utilizadas na questão 1 em logaritmo natural. Utilize o método stepwise para selecionar os preditores. Faça um resumo dos passos que o algoritmo tomou. Faça o gráfico dos valores preditos versus os resíduos studentizados para o modelo final. Compare com a resposta da questão 1.
3. Para o modelo final da questão 2, faça o diagnóstico completo avaliando as suposições sobre os resíduos, multicolinearidade e observações influentes. Interprete os resultados.