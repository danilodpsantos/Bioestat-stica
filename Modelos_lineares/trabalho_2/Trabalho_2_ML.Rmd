---
title: "Modelos Lineares PPGEPI"
author: "Gabriela Wünsch Lopes e Danilo de Paula Santos"
date: "02/12/2019"
output: word_document
---

#Instruções:

Cada dupla deverá escolher uma base de dados, que pode ser analisado via modelos lineares (um desfecho quantitativo e no mínimo dois preditores). 

Proceder a análise descritiva, modelagem e análise de diagnóstico.
Preparar o parágrafo da análise estatística conforme seria necessário para a seção de Métodos para um artigo. 

Construir as tabelas e/ou figuras, e escrever as interpretações, como para uma sessão de Resultados de um artigo. 

Preparar uma apresentação de 15 minutos para dia 06/12.

Postar o arquivo em Word, a apresentação e os dados em SPSS/XLS/CSV. 
Referir a fonte dos dados.

``` {r config}

# install.packages("ggplot2")
# install.packages("car")
# install.packages("tidyverse")
# install.packages("mctest")


library("ggplot2")
library("car")
library("tidyverse")
library("mctest")
library("compareGroups")
```


# Descrição do banco:

## Diabetes Dataset:

These data are courtesy of Dr John Schorling, Department of Medicine, University of Virginia School of Medicine.
The data consist of 19 variables on 403 subjects from 1046 subjects who were interviewed in a study to understand the prevalence of obesity, diabetes, and other cardiovascular risk factors in central Virginia for African Americans. According to Dr John Hong, Diabetes Mellitus Type II (adult onset diabetes) is associated most strongly with obesity. The waist/hip ratio may be a predictor in diabetes and heart disease. DM II is also agssociated with hypertension - they may both be part of "Syndrome X". The 403 subjects were the ones who were actually screened for diabetes. Glycosolated hemoglobin > 7.0 is usually taken as a positive diagnosis of diabetes. For more information about this study see

Willems JP, Saunders JT, DE Hunt, JB Schorling: Prevalence of coronary heart disease risk factors among rural blacks: A community-based study. Southern Medical Journal 90:814-820; 1997

and

Schorling JB, Roach J, Siegel M, Baturka N, Hunt DE, Guterbock TM, Stewart HL: A trial of church-based smoking cessation interventions for rural African Americans. Preventive Medicine 26:92-101; 1997.



## Documentação banco:


!["Documentação banco"](documenta_banco.PNG)

``` {r datasets}

dados_dm <- read.csv("diabetes.csv")

# convertendo as medidas do sistema imperial para o métrico:

dados_dm$peso_kg <- dados_dm$weight * 0.453592

dados_dm$altura_cm <- dados_dm$height * 2.54

dados_dm$cintura_cm <- dados_dm$waist  * 2.54

dados_dm$quadril_cm <- dados_dm$hip * 2.54

dados_dm$taxa_hdl <- 1/dados_dm$ratio

dados_dm$imc <- dados_dm$peso_kg / I((dados_dm$altura_cm/100) ^2)

dados_dm$rcq <- dados_dm$cintura_cm/dados_dm$quadril_cm


# Filtrando o banco para pacientes não diabéticos

dados_dm <- dados_dm %>%
            filter(glyhb >= 4.008) %>% 
            filter(glyhb <= 6.5) %>%
            filter(is.na(glyhb) == FALSE)


```


# Hipótese:

Níveis séricos mais altos de colesterol HDL se associam com um melhor controle glicêmico em pessoas não diabéticas.

```{r descritivas}

compare_dm <- compareGroups(data = dados_dm,  ~ gender + age + glyhb + chol + hdl + taxa_hdl+ bp.1s + + taxa_hdl + imc + rcq )

tabela_dm <- createTable(compare_dm)

export2md(tabela_dm)

```


```{r plots}


plot(tabela_dm)

```

Avaliação da linearidade da relação entre colesterol HDL e hemoglobina glicada:

# Explorando as relações das variáveis explicativas com a variável resposta:

``` {r scatter_taxa_hdl}

scatter_taxa_hdl <- ggplot(dados_dm, aes(x = I(taxa_hdl*100), y = glyhb)) +
                                 geom_point() +
                                 scale_x_continuous("Taxa de colesterol hdl") +
                                 scale_y_continuous("Hemoglobina glicada (%)") +
                                 theme_minimal() 
scatter_taxa_hdl

```

```{r lm_taxa_hdl}

lm_taxa_hdl <- lm(formula = glyhb ~ I(taxa_hdl*100),
                    data = dados_dm)

summary(lm_taxa_hdl)

```


``` {r scatter_imc}

scatter_imc <- ggplot(dados_dm, aes(x = imc, y = glyhb)) +
                                 geom_point() +
                                 scale_x_continuous("IMC (km/m2)") +
                                 scale_y_continuous("hemoglobina glicada (%)") +
                                 theme_minimal() 
scatter_imc

```


```{r lm_imc}

lm_imc <- lm(formula = glyhb ~ imc,
                    data = dados_dm)

summary(lm_imc)

```


``` {r scatter_age}

scatter_age <- ggplot(dados_dm, aes(x = age, y = glyhb) )+
                                 geom_point() +
                                 scale_x_continuous("Idade (anos)") +
                                 scale_y_continuous("hemoglobina glicada (%)") 

scatter_age
                      
                      
```


```{r lm_age}

lm_age <- lm(formula = glyhb ~ age,
                    data = dados_dm)

summary(lm_age)

```

``` {r scatter_rcq}

scatter_rcq <- ggplot(dados_dm, aes(x = rcq, y = glyhb)) +
                                 geom_point() +
                                 scale_x_continuous("Razão cintura/quadril") +
                                 scale_y_continuous("hemoglobina glicada (%)") +
                                 theme_minimal() 
scatter_rcq

```


```{r lm_rcq}

lm_rcq <- lm(formula = glyhb ~ rcq,
                    data = dados_dm)

summary(lm_rcq)

```




``` {r scatter_bp}

scatter_bp <- ggplot(dados_dm, aes(x = bp.1s, y = glyhb)) +
                                 geom_point() +
                                 scale_x_continuous("Razão cintura/quadril") +
                                 scale_y_continuous("hemoglobina glicada (%)") +
                                 theme_minimal() 
scatter_bp

```

```{r lm_bp}

lm_bp <- lm(formula = glyhb ~ bp.1s,
                    data = dados_dm)

summary(lm_bp)

```



## Montando um novo modelo, agora com ajuste para outras variáveis

* Nosso método de modelagem será o stepwise baseado R2 ajustado. 

Incluindo idade e sexo, variáveis que serão mantidas no modelo independentemente de significância estatística: 

```{r lm_taxa_hdl1}

lm_taxa_hdl1 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age  ,
                    data = dados_dm)

summary(lm_taxa_hdl1)

```

```{r lm_taxa_hdl2}

lm_taxa_hdl2 <- lm(formula = glyhb ~ I(taxa_hdl*100) + gender  ,
                    data = dados_dm)

summary(lm_taxa_hdl2)

```

```{r lm_taxa_hdl3}

lm_taxa_hdl3 <- lm(formula = glyhb ~ I(taxa_hdl*100) + imc  ,
                    data = dados_dm)

summary(lm_taxa_hdl3)

```

```{r lm_taxa_hdl4}

lm_taxa_hdl4 <- lm(formula = glyhb ~ I(taxa_hdl*100) + rcq,
                    data = dados_dm)

summary(lm_taxa_hdl4)

```


```{r lm_taxa_hdl5}

lm_taxa_hdl5 <- lm(formula = glyhb ~ I(taxa_hdl*100) + bp.1s,
                    data = dados_dm)

summary(lm_taxa_hdl5)

```


A primeira variável a ser incluída no modelo será a idade. Adjusted R-squared:  0.1033 

Agrora vamos testar a inclusão  das outras variáveis no modelo que inclui idade:

```{r lm_taxa_hdl_age1}

lm_taxa_hdl_age1 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + gender  ,
                    data = dados_dm)

summary(lm_taxa_hdl_age1)

```

```{r lm_taxa_hdl_age2}

lm_taxa_hdl_age2 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + imc  ,
                    data = dados_dm)

summary(lm_taxa_hdl_age2)

```


```{r lm_taxa_hdl_age3}

lm_taxa_hdl_age3 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + rcq ,
                    data = dados_dm)

summary(lm_taxa_hdl_age3)

```


```{r lm_taxa_hdl_age4}

lm_taxa_hdl_age4 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + bp.1s  ,
                    data = dados_dm)

summary(lm_taxa_hdl_age4)

```


A segunda variável a ser incluída no modelo será o sexo Adjusted R-squared: Adjusted R-squared:  0.1006 

```{r lm_taxa_hdl_age_gender1}

lm_taxa_hdl_age_gender1 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + gender + rcq ,
                    data = dados_dm)

summary(lm_taxa_hdl_age_gender1)

vif(lm_taxa_hdl_age_gender1)

```

```{r lm_taxa_hdl_age_gender2}

lm_taxa_hdl_age_gender2 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + gender + imc ,
                    data = dados_dm)

summary(lm_taxa_hdl_age_gender2)

vif(lm_taxa_hdl_age_gender2)
```

```{r lm_taxa_hdl_age_gender3}

lm_taxa_hdl_age_gender3 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + gender + rcq + imc ,
                    data = dados_dm)

summary(lm_taxa_hdl_age_gender3)

vif(lm_taxa_hdl_age_gender3)

```

```{r lm_taxa_hdl_age_imc1}

lm_taxa_hdl_age_imc1 <- lm(formula = glyhb ~ I(taxa_hdl*100) + age + rcq + imc ,
                    data = dados_dm)

summary(lm_taxa_hdl_age_imc1)

vif(lm_taxa_hdl_age_imc1)

```

```{r plot_final}

plot(lm_taxa_hdl_age_imc1)

```