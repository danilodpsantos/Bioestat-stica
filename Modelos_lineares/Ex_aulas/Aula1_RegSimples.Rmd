---
title: "Modelos lineares aula 1"
author: "Danilo de Paula Santos/Gabriela Wunsch Lopes"
date: "17/10/2019"
output:
  pdf_document:
    latex_engine: pdflatex
  html_document: default
---

```{r preparacao_do_R, message=FALSE, warning=FALSE}

# install.packages("compareGroups")
# install.packages("ggplot2")
# install.packages("data.table")


library("compareGroups")
library("ggplot2")
library("haven")
library("ggpubr")
library("dplyr")

```

# Suwit dataset

## Estudo da relação entre infecção por ancilóstomo e perda de sangue. Tailândia 1970

```{r carregando_suwit}

suwit <- read_sav("Bancos/Suwit.sav")

```

#### Primeiro passo: verificar o banco

```{r descritiva_suwit}

compare_suwit <- compareGroups( ~ ., data = suwit)

summary(compare_suwit)
```

```{r tabela_suwit}

tabela_suwit <- createTable(compare_suwit)

tabela_suwit

```

#### Segundo passo: verificar linearidade com gráfico de dispersão. Identificar pontos

Gráfico de dispersão

```{r suwit_scatter }

suwit_scatter <- ggplot(suwit, aes(x = vermes, y = perda_sangue))+
  geom_point() +
  scale_x_continuous("Número de vermes") +
  scale_y_continuous("Perda de sangue por um dia") +
  theme_minimal()

suwit_scatter
```

Identificando pontos: qual o ID do ponto mais extremo na vertical?

```{r outlier_na_vertical, echo=TRUE}

suwit %>%
  filter(perda_sangue>75, vermes<1500)

```



```{r suwit_regression}

lm_suwit <- lm(formula = perda_sangue ~ vermes,
                    data = suwit)

summary(lm_suwit)

```

``` {r confint_suwit }

confint(lm_suwit)

```

A cada aumento 1 verme, ocorre um aumento de 0.04 (95%IC 0.026 - 0.056), sendo que 71,6% da variabilidade da perda total de sangue decorre do aumento do número de vermes.



``` {r confidence_prediction_suwit }

suwit_pred <- predict(lm_suwit, interval = 'predict')

suwit <- cbind(suwit, suwit_pred)

suwit_pred_plot <- ggplot(suwit, aes(x = vermes, y = perda_sangue)) +
                                 geom_point() +
                                 geom_smooth(method = "lm") +
                                 theme_minimal() +
                                 geom_line(aes(y = lwr), col = "coral2", linetype = "dashed") +
                                 geom_line(aes(y = upr), col = "coral2", linetype = "dashed") +
  labs(title = paste("Adj R2 = ",signif(summary(lm_suwit)$adj.r.squared, 5),
                         "Intercept =",signif(lm_suwit$coef[[1]],5 ),
                         " Slope =",signif(lm_suwit$coef[[2]], 5),
                         " p =",signif(summary(lm_suwit)$coef[2,4], 5)))
  
  
  
  
suwit_pred_plot
                    


```

A faixa cinza corresponde ao intervalo de confiança e as linhas laranja são os limites do intervalo de predição.

# Fat_dat dataset

## Estudo Fat_dat "Fitting Percentage of Body Fat to Simple Body Measurements"


```{r carregando_fat_dat}

fat_dat <- read_sav("Bancos/fat_dat.sav")

```

Corrigindo os erros de digitação:

- The body densities for cases 48, 76, and 96, for instance, each seem to have one digit in error as can be seen from the two body fat percentage values.
- Case 42) over 200 pounds in weight who is less than 3 feet tall (the height should presumably be 69.5 inches, not 29.5 inches)!
- The percent body fat estimates are truncated to zero when negative (case 182)

```{r corrigindo_fat_dat}
# Altura

fat_dat$altura_pol <- ifelse( fat_dat$numero == 42, 69.5, fat_dat$altura_pol)

# Densidades

fat_dat$densidade <- ifelse( fat_dat$numero == 48, 1.0865, fat_dat$densidade)
fat_dat$densidade <- ifelse( fat_dat$numero == 76, 1.0566, fat_dat$densidade)
fat_dat$densidade <- ifelse( fat_dat$numero == 96, 1.0591, fat_dat$densidade)

```

```{r descritivas_fat_dat}
compare_fat <- compareGroups( ~ ., data = fat_dat)

summary(compare_fat)
```


```{r tabela_fat_dat}

tabela_fat <- createTable(compare_fat)

```

```{r normalidade_fat_dat }

plot(compare_fat)

```

```{r dispersao_fat_Brozek }

disp_fat_Brozek<- ggplot(fat_dat, aes(x = imc, y = fat_Brozek))+
  geom_point() +
  theme_minimal()

disp_fat_Brozek
```

```{r lm_fat_Brozek}

lm_imc_brozek <- lm(formula = fat_Brozek ~ imc,
                    data = fat_dat)

summary(lm_imc_brozek)

```
``` {r confint_fat_Brozek }

confint(lm_imc_brozek)

```

A cada aumento de 1 unidade no IMC ocorre aumento de 1.55% na gordura corporal pelo índice Brozek. O intervalo de confiança é de 1.36 a 1.73.

```{r predict_fat_brozek}

brozek_pred <- predict(lm_imc_brozek, interval = "predict")

dat_brozek <-cbind(fat_dat, brozek_pred)
```

```{r regression_plot_fat_Brozek }

plot_fat_Brozek <- ggplot(dat_brozek, aes(x = imc, y = fat_Brozek))+
  geom_point() + 
  geom_smooth (method = "lm",)+
  theme_minimal() +
  geom_line(aes(y = lwr), col = "coral2", linetype = "dashed") +   geom_line(aes(y = upr), col = "coral2", linetype = "dashed")

plot_fat_Brozek
```

```{r regressao_linear_fat_Siri }

lm_imc_siri <- lm(formula = fat_Siri  ~ imc,
                    data = fat_dat)

summary(lm_imc_siri)

```
``` {r confint_fat_siri }

confint(lm_imc_siri)

```

Para o aumento de 1 ponto no IMC ocorre  aumento de 1.7% (95%IC 1.5-1.86) na gordura corporal. O modelo explica 52% da variabilidade da gordura corporal.

```{r predict_fat_siri}

siri_pred <- predict(lm_imc_siri, interval = "predict")

dat_siri <-cbind(fat_dat, siri_pred)
```

```{r regression_plot_fat_siri }

plot_fat_siri <- ggplot(dat_siri, aes(x = imc, y = fat_Siri))+
  geom_point() + 
  geom_smooth (method = "lm",)+
  theme_minimal() +
  geom_line(aes(y = lwr), col = "coral2", linetype = "dashed") +   geom_line(aes(y = upr), col = "coral2", linetype = "dashed")

plot_fat_siri
```



# Anscombe dataset

## 4 bancos com formas funcionais diferentes mas estatísticas resumo e linhas de regressão idênticas

```{r anscombe_dataset}

anscombe_dataset <- data("anscombe")

```

```{r anscombe_descriptives}

compare_anscombe <- compareGroups(data = anscombe, ~ x1+
                                     x2+
                                     x3+
                                     x4)

createTable(compare_anscombe)
```

```{r anscombe_scatter_x1 }

x1_scatter <- ggplot(anscombe, aes(x = x1, y = y1))+
  geom_point() +
  theme_minimal()+
  geom_smooth(method = "lm", se = FALSE)

x1_scatter
```

```{r anscombe_scatter_x2 }

x2_scatter <- ggplot(anscombe, aes(x = x2, y = y2))+
  geom_point() +
  theme_minimal() +
  geom_smooth(method = "lm", se = FALSE)

x2_scatter
```
```{r anscombe_scatter_x3 }

x3_scatter <- ggplot(anscombe, aes(x = x3, y = y3))+
  geom_point() +
  theme_minimal() +
  geom_smooth(method = "lm", se = FALSE)

x3_scatter
```
```{r anscombe_scatter_x4 }

x4_scatter <- ggplot(anscombe, aes(x = x4, y = y4))+
  geom_point() +
  theme_minimal() +
  geom_smooth(method = "lm", se = FALSE)

x4_scatter
```

